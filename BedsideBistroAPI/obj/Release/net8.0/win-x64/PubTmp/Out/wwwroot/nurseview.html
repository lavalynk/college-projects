<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BedsideBistro — Nurse Dashboard</title>
<style>
  :root{
    --bg:#f7faf9; --surface:#fff; --text:#1b1f1e; --muted:#6b7671;
    --brand:#2f7d5f; --brand-600:#2a6f55; --brand-050:#e9f5f0;
    --outline:#cfe5db; --tab:#e6ebe9; --shadow:0 6px 18px rgba(0,0,0,.08);
    --ok:#2f7d5f; --warn:#b56a00; --alert:#b83b3b;
    --radius:18px;
  }
  *,*::before,*::after{box-sizing:border-box}
  html,body{margin:0;padding:0}
  body{
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    color:var(--text); line-height:1.45;
    background: radial-gradient(1200px 600px at 80% -10%, var(--brand-050), transparent 60%), var(--bg);
  }
  a{color:inherit;text-decoration:none}
  .container{width:min(1280px,94vw);margin:0 auto}
  :focus-visible{outline:3px solid #8fd6b9;outline-offset:2px;border-radius:10px}
  .sr-only{position:absolute!important;width:1px;height:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;border:0;padding:0;margin:-1px}

  /* Header */
  header{position:sticky;top:0;z-index:40;backdrop-filter:saturate(1.1) blur(6px)}
  .nav{display:grid;grid-template-columns:1fr auto auto;gap:1rem;align-items:center;padding:14px 0}
  .brand{display:flex;align-items:center;gap:.6rem;font-weight:800}
  .brand-badge{width:28px;height:28px;display:grid;place-items:center;border-radius:9px;background:linear-gradient(135deg,var(--brand),var(--brand-600));color:#fff;font-weight:800;font-size:.9rem;box-shadow:var(--shadow)}
  .search{display:flex;align-items:center;gap:.6rem;background:var(--surface);border:1px solid var(--outline);border-radius:999px;padding:10px 12px;min-width:min(420px,50vw);box-shadow:var(--shadow)}
  .search input{border:0;outline:0;width:100%;font:inherit;background:transparent}
  .profile{margin-left:auto;display:flex;align-items:center;gap:.6rem;background:var(--surface);border:1px solid var(--outline);padding:6px 8px 6px 6px;border-radius:999px;box-shadow:var(--shadow)}
  .avatar{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,#e7f3ed,#d6efe5);display:grid;place-items:center;border:1px solid var(--outline)}

  /* Layout */
  .layout{display:grid;grid-template-columns:0.95fr 1.05fr;gap:18px;margin:10px 0 24px;}
  @media (max-width:1000px){ .layout{grid-template-columns:1fr} }

  /* Left: list */
  .panel{background:var(--surface);border:1px solid var(--outline);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
  .pad{padding:14px 14px 18px}
  .section-head{display:flex;justify-content:space-between;align-items:baseline;margin:4px 0 10px}
  .section-head h2{margin:0;font-size:1.05rem}
  .list{display:grid;gap:12px}
  .cell{
    border:2px solid var(--outline);border-radius:16px;background:#fff;padding:10px;display:grid;gap:8px;cursor:pointer;
    transition:border-color .2s, box-shadow .2s, background .2s;
  }
  .cell:hover{box-shadow:0 10px 22px rgba(0,0,0,.08)}
  .cell.selected{outline:3px solid #8fd6b9}
  .cell.delivered{background:#f5f7f6;color:#68746e}
  .meta{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .name{font-weight:800}
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;font-size:.95rem}
  .pill{font-size:.85rem;padding:6px 9px;border-radius:999px;border:1px dashed var(--outline);background:#fbfefd;color:#2b3a34}
  .eta{font-size:.85rem;padding:6px 9px;border-radius:999px;border:1px solid var(--outline);background:#eaf2ef}
  .eta.ok{border-color:#cfe5db;color:var(--ok)}
  .eta.warn{border-color:#f0d9b3;color:var(--warn);background:#fff7e8}
  .eta.late{border-color:#f0c1c1;color:var(--alert);background:#ffe9e9}

  /* Flash for not-approved orders */
  @keyframes pulse-approve{
    0%{border-color:#aee6cd; box-shadow:0 0 0 0 rgba(47,125,95,.25)}
    50%{border-color:#2f7d5f; box-shadow:0 0 0 6px rgba(47,125,95,.12)}
    100%{border-color:#aee6cd; box-shadow:0 0 0 0 rgba(47,125,95,.0)}
  }
  .needs-approval{animation:pulse-approve 2.2s infinite}

  /* Stepper (compact, legible) */
  .steps{position:relative;padding:10px 4px 0}
  .steps::before{
    content:"";position:absolute;left:18px;right:18px;top:16px;height:4px;background:#e8efe9;border-radius:999px;z-index:0;
  }
  .steps .track{
    position:absolute;left:18px;top:16px;height:4px;background:linear-gradient(90deg,var(--brand),var(--brand-600));border-radius:999px;z-index:0;width:0;
    transition:width .4s ease;
  }
  .steps .row{position:relative;display:flex;justify-content:space-between;z-index:1}
  .step{display:grid;justify-items:center;gap:6px;min-width:0}
  .dot{
    width:22px;height:22px;border-radius:50%;display:grid;place-items:center;
    background:#fff;border:2px solid #cfe5db;color:#2f7d5f;font-size:.8rem;font-weight:800;z-index:2;
    box-shadow:0 1px 0 rgba(0,0,0,.04)
  }
  .done .dot{background:linear-gradient(135deg,var(--brand),var(--brand-600));color:#fff;border-color:transparent}
  .active .dot{border-color:#2f7d5f}
  .label{font-size:.78rem;color:#5f6a66;white-space:nowrap}
  .timestamp{font-size:.72rem;color:#9aa6a1}

  /* Right: detail */
  .detail{background:var(--surface);border:1px solid var(--outline);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
  .cardish{border:1px solid var(--outline);border-radius:16px;padding:12px;background:#fff}
  .badges{display:flex;gap:.4rem;flex-wrap:wrap}
  .chip{font-size:.8rem;padding:6px 9px;border-radius:999px;border:1px dashed var(--outline);background:#fbfefd}
  .chip.allergen{border-style:solid;border-color:#f0c1c1;background:#ffe9e9;color:#8b2323}
  .items{display:grid;gap:8px}
  .kv{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center}
  .cta{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
  .btn{appearance:none;border:1px solid var(--outline);background:#fff;border-radius:12px;padding:10px 12px;font-weight:800;cursor:pointer}
  .btn.primary{background:linear-gradient(135deg,var(--brand),var(--brand-600));border-color:transparent;color:#fff}
  .btn.danger{border-color:#e7b0b0;color:#8b2323}
  .hint{color:var(--muted);font-size:.95rem}

  /* Modal */
  #approveToggle{display:none}
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;padding:16px;z-index:60}
  #approveToggle:checked ~ .modal-backdrop.approve{display:flex}
  .modal{width:min(640px,96vw);background:#fff;border:1px solid var(--outline);border-radius:18px;box-shadow:0 20px 50px rgba(0,0,0,.25);overflow:hidden}
  .modal .pad{padding:14px 16px}
  .modal .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}

  /* Toast */
  .toast{position:fixed;right:16px;bottom:16px;background:#162d25;color:#fff;border-radius:12px;padding:10px 12px;box-shadow:0 10px 24px rgba(0,0,0,.25);opacity:0;transform:translateY(8px);transition:all .25s ease;z-index:80}
  .toast.show{opacity:1;transform:translateY(0)}

  /* small utils */
  .muted{color:var(--muted)}
</style>
</head>
<body>
<a class="sr-only" href="#content">Skip to content</a>

<header>
  <div class="container nav">
    <div class="brand">
      <span class="brand-badge" aria-hidden="true">BB</span>
      <span>BedsideBistro — Nurse</span>
    </div>
    <label class="search" aria-label="Search floor orders">
      <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79L20 21.5 21.5 20l-6-6z"/></svg>
      <input type="search" placeholder="Search by room, MRN, patient…" />
    </label>
    <button class="profile" aria-label="Nurse profile">
      <div class="avatar" aria-hidden="true">
        <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M12 12a5 5 0 1 0-5-5 5.006 5.006 0 0 0 5 5zm0 2c-4.33 0-8 2.17-8 5v1h16v-1c0-2.83-3.67-5-8-5z"/></svg>
      </div>
    </button>
  </div>
</header>

<main id="content" class="container">
  <div class="layout">
    <!-- LEFT: Orders list -->
    <section class="panel">
      <div class="pad">
        <div class="section-head">
          <h2>Floor orders — 4B</h2>
          <div class="hint" id="countHint">0 active</div>
        </div>
        <div id="orderList" class="list" role="list"></div>
      </div>
    </section>

    <!-- RIGHT: Detail -->
    <aside class="detail" id="detail">
      <div class="pad">
        <div class="section-head">
          <h2>Selected order</h2>
          <span class="hint mono" id="selId">—</span>
        </div>

        <div class="cardish" id="summaryCard">
          <div class="kv"><strong id="pTitle">—</strong><span class="pill" id="pRoom">Room —</span></div>
          <div class="badges" id="dietBadges" style="margin-top:6px"></div>
          <div class="badges" id="allerBadges" style="margin-top:6px"></div>

          <div class="steps" style="margin-top:10px">
            <div class="track" id="track"></div>
            <div class="row" id="stepsRow">
              <!-- Steps render here -->
            </div>
          </div>

          <div class="items" id="items" style="margin-top:10px"></div>

          <div class="cardish" style="margin-top:10px">
            <strong>Nutritional snapshot</strong>
            <div class="badges" id="nutrition" style="margin-top:6px"></div>
          </div>

          <p class="hint" id="noteLine" style="margin-top:8px"></p>
        </div>

        <div class="cta" id="actions" style="margin-top:10px">
          <!-- Approve / Reject appear here for unapproved orders -->
        </div>
      </div>
    </aside>
  </div>
</main>

<!-- Approve Modal -->
<input type="checkbox" id="approveToggle" />
<div class="modal-backdrop approve" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="approveTitle">
    <div class="pad">
      <div class="head">
        <strong id="approveTitle">Approve order?</strong>
        <label for="approveToggle" class="btn" role="button" aria-label="Close">Go back</label>
      </div>
      <p>Have you reviewed the order carefully with the patient?</p>
      <div class="cta">
        <label for="approveToggle" class="btn">Go back</label>
        <button id="approveConfirm" class="btn primary" type="button">Approve</button>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite">Saved</div>

<script>
  /* ---------- Sample data ---------- */
  const state = {
    nurseName: "J. Carter, RN",
    orders: [
      {
        id:"BB-901", name:"Wooldridge, Josie", mrn:"004219", room:"4B-213",
        approved:false, status:"placed", placedAt:Date.now()-3*60*1000,
        diet:["Cardiac (low sodium)"], allergens:["Peanut"],
        items:[
          {name:"Grilled Chicken Salad", mods:["No croutons","Extra tomatoes","Dressing on side"], kcal:350, protein:28, sodium:380},
          {name:"Cucumber Mint Water", mods:[], kcal:0, protein:0, sodium:0}
        ],
        note:"Patient wants dressing separate."
      },
      {
        id:"BB-902", name:"Singh, Maya", mrn:"003108", room:"3A-118",
        approved:true, status:"preparing", placedAt:Date.now()-14*60*1000, receivedAt:Date.now()-12*60*1000,
        diet:["Whole grain"], allergens:["Wheat"],
        items:[
          {name:"Turkey & Avocado Sandwich", mods:["No mayo","Cut in halves"], kcal:420, protein:24, sodium:520}
        ],
        note:""
      },
      {
        id:"BB-903", name:"Nguyen, Linh", mrn:"002808", room:"4B-210",
        approved:true, status:"waiting", placedAt:Date.now()-24*60*1000, receivedAt:Date.now()-20*60*1000,
        diet:["Vegetarian"], allergens:["Milk"],
        items:[{name:"Tomato Basil Soup", mods:["No croutons"], kcal:210, protein:6, sodium:420}],
        note:""
      },
      {
        id:"BB-904", name:"Ramirez, Kai", mrn:"004301", room:"4B-214",
        approved:true, status:"delivered", placedAt:Date.now()-60*60*1000, receivedAt:Date.now()-56*60*1000, deliveredAt:Date.now()-6*60*1000,
        diet:["Vegan","Renal-friendly"], allergens:["Sesame"],
        items:[{name:"Roasted Veggie Bowl", mods:["Extra tahini"], kcal:380, protein:13, sodium:410}],
        note:""
      }
    ]
  };

  /* ---------- Helpers ---------- */
  const $ = s => document.querySelector(s);
  const $$ = s => [...document.querySelectorAll(s)];
  const toast = (t)=>{ const el=$("#toast"); el.textContent=t; el.classList.add("show"); setTimeout(()=>el.classList.remove("show"),1400); };
  const fmt = (d)=> new Date(d).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
  const fmtFull = (d)=> new Date(d).toLocaleString([], {year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit'});
  const stepOrder = ["placed","received","preparing","waiting","onway","delivered"];
  const stepLabels = ["Order placed","Order received","Preparing order","Waiting for runner","On the way","Delivered"];

  function statusIndex(s){ return Math.max(0, stepOrder.indexOf(s)); }

  function etaClass(mins){
    if(mins >= 25) return "late";
    if(mins >= 18) return "warn";
    return "ok";
  }

  function calcETA(order){
    // very rough demo ETA based on status/age
    const ageMin = Math.floor((Date.now()-(order.receivedAt||order.placedAt))/60000);
    if(order.status==="placed") return {text:"Awaiting approval", cls:"warn"};
    if(order.status==="received") return {text:`ETA ~ 15m`, cls:"ok"};
    if(order.status==="preparing") return {text:`Prep ${ageMin}/15m`, cls:etaClass(ageMin)};
    if(order.status==="waiting") return {text:`Ready — call runner`, cls:"warn"};
    if(order.status==="onway") return {text:`On the way`, cls:"ok"};
    if(order.status==="delivered") return {text:`Delivered ${fmt(order.deliveredAt)}`, cls:"ok"};
    return {text:"—", cls:"ok"};
  }

  /* ---------- Render left list ---------- */
  const listEl = $("#orderList");

  function sortedOrders(){
    const open = state.orders.filter(o=>o.status!=="delivered");
    const done = state.orders.filter(o=>o.status==="delivered");
    // open: newest placed first
    open.sort((a,b)=>(b.placedAt)-(a.placedAt));
    // delivered: oldest first but shown at bottom
    done.sort((a,b)=>(a.deliveredAt||0)-(b.deliveredAt||0));
    return [...open, ...done];
  }

  function buildCell(o){
    const cell = document.createElement("article");
    cell.className = "cell";
    cell.setAttribute("role","listitem");
    if(!o.approved && o.status==="placed") cell.classList.add("needs-approval");
    if(o.status==="delivered") cell.classList.add("delivered");
    cell.dataset.id = o.id;

    const eta = calcETA(o);

    cell.innerHTML = `
      <div class="meta">
        <span class="name">${o.name}</span>
        <span class="mono">MRN ${o.mrn}</span>
        <span class="pill">Room ${o.room}</span>
        <span class="eta ${eta.cls}">${eta.text}</span>
      </div>
      <div class="steps" aria-label="Order status">
        <div class="track"></div>
        <div class="row">
          ${stepOrder.map((s,i)=>{
            const idx = statusIndex(o.status);
            const cls = i < idx ? "step done" : (i===idx ? "step active" : "step");
            return `
              <div class="${cls}">
                <div class="dot">${i+1}</div>
                <div class="label">${stepLabels[i]}</div>
              </div>`;
          }).join("")}
        </div>
      </div>
      ${o.status==="delivered" ? `<div class="timestamp"><strong>Delivered</strong> at ${fmtFull(o.deliveredAt)}</div>` : ""}
    `;

    // fill track width
    const idx = statusIndex(o.status);
    const track = cell.querySelector(".track");
    const pct = (idx/(stepOrder.length-1))*100;
    track.style.width = `calc(${pct}% - 18px)`;

    cell.addEventListener("click", ()=> selectOrder(o.id));
    return cell;
  }

  function renderList(){
    listEl.innerHTML = "";
    const orders = sortedOrders();
    $("#countHint").textContent = `${orders.filter(o=>o.status!=="delivered").length} active`;
    orders.forEach(o=> listEl.appendChild(buildCell(o)));
    // keep selection if possible
    if(selectedId){
      const still = state.orders.find(x=>x.id===selectedId);
      if(still) highlightCell(selectedId);
      else selectOrder(orders[0]?.id);
    } else if(orders.length){ selectOrder(orders[0].id); }
  }

  function highlightCell(id){
    $$(".cell").forEach(c=> c.classList.toggle("selected", c.dataset.id===id));
  }

  /* ---------- Detail pane ---------- */
  let selectedId = null;

  function selectOrder(id){
    selectedId = id;
    highlightCell(id);
    const o = state.orders.find(x=>x.id===id);
    if(!o){ clearDetail(); return; }
    $("#selId").textContent = o.id;
    $("#pTitle").textContent = `${o.name} • MRN ${o.mrn}`;
    $("#pRoom").textContent = `Room ${o.room}`;

    // diet + allergens
    const diet = $("#dietBadges"); diet.innerHTML = (o.diet||[]).map(d=>`<span class="chip">${d}</span>`).join("");
    const aller = $("#allerBadges"); aller.innerHTML = (o.allergens||[]).map(a=>`<span class="chip allergen">${a}</span>`).join("") || `<span class="muted">No allergies recorded</span>`;

    // items
    const items = $("#items"); items.innerHTML = "";
    (o.items||[]).forEach(it=>{
      const el = document.createElement("div");
      el.className = "cardish";
      el.innerHTML = `
        <div class="kv"><strong>${it.name}</strong><span class="mono">${it.kcal? `~${it.kcal} kcal`:""}</span></div>
        <div class="muted">${(it.mods||[]).join(" · ") || "No modifications"}</div>
      `;
      items.appendChild(el);
    });

    // nutrition snapshot
    const totals = (o.items||[]).reduce((a,x)=>({
      kcal:a.kcal+(x.kcal||0), protein:a.protein+(x.protein||0), sodium:a.sodium+(x.sodium||0)
    }),{kcal:0,protein:0,sodium:0});
    $("#nutrition").innerHTML = `
      <span class="chip mono">~${totals.kcal} kcal</span>
      <span class="chip mono">${totals.protein}g protein</span>
      <span class="chip mono">&lt; ${totals.sodium}mg sodium</span>
    `;

    // note
    $("#noteLine").textContent = o.note ? `Note: ${o.note}` : "";

    // stepper in detail (reuse same render as cell)
    renderDetailStepper(o);

    // actions
    const actions = $("#actions");
    actions.innerHTML = "";
    if(!o.approved && o.status==="placed"){
      // show approve/reject
      const approveBtn = document.createElement("label");
      approveBtn.className = "btn primary";
      approveBtn.setAttribute("for","approveToggle");
      approveBtn.textContent = "Approve";
      actions.appendChild(approveBtn);

      const rejectBtn = document.createElement("button");
      rejectBtn.className = "btn danger";
      rejectBtn.textContent = "Reject";
      rejectBtn.addEventListener("click", ()=> rejectOrder(o.id));
      actions.appendChild(rejectBtn);

      // store which one to approve
      $("#approveConfirm").dataset.target = o.id;
    } else {
      const info = document.createElement("div");
      info.className = "hint";
      info.textContent = (o.status==="delivered")
        ? `Order delivered at ${fmtFull(o.deliveredAt)}`
        : `Status: ${stepLabels[statusIndex(o.status)]}`;
      actions.appendChild(info);
      // demo-only controls to simulate delivered:
      if(o.status!=="delivered"){
        const sim = document.createElement("button"); sim.className="btn"; sim.textContent="(Demo) Mark delivered";
        sim.addEventListener("click", ()=> markDelivered(o.id));
        actions.appendChild(sim);
      }
    }
  }

  function clearDetail(){
    $("#selId").textContent = "—";
    $("#pTitle").textContent = "—";
    $("#pRoom").textContent = "Room —";
    $("#dietBadges").innerHTML = "";
    $("#allerBadges").innerHTML = "";
    $("#items").innerHTML = "";
    $("#nutrition").innerHTML = "";
    $("#noteLine").textContent = "";
    $("#actions").innerHTML = "";
    $("#stepsRow").innerHTML = "";
    $("#track").style.width = "0";
  }

  function renderDetailStepper(o){
    const row = $("#stepsRow");
    row.innerHTML = stepOrder.map((s,i)=>{
      const idx = statusIndex(o.status);
      const cls = i < idx ? "step done" : (i===idx ? "step active" : "step");
      return `
        <div class="${cls}">
          <div class="dot">${i+1}</div>
          <div class="label">${stepLabels[i]}</div>
        </div>`;
    }).join("");
    const pct = (statusIndex(o.status)/(stepOrder.length-1))*100;
    $("#track").style.width = `calc(${pct}% - 18px)`;
  }

  /* ---------- Actions ---------- */
  function approveOrder(id){
    const o = state.orders.find(x=>x.id===id);
    if(!o) return;
    o.approved = true;
    o.status = "received";
    o.receivedAt = Date.now();
    toast("Order approved — sent to kitchen");
    renderList(); selectOrder(id);
  }

  function rejectOrder(id){
    const i = state.orders.findIndex(x=>x.id===id);
    if(i<0) return;
    const o = state.orders[i];
    state.orders.splice(i,1);
    toast(`Order rejected by ${state.nurseName}. Patient notified.`);
    renderList();
    // simulate: patient redirected to order summary — (not shown here)
  }

  function markDelivered(id){
    const o = state.orders.find(x=>x.id===id);
    if(!o) return;
    o.status = "delivered";
    o.deliveredAt = Date.now();
    toast("Marked delivered");
    renderList(); selectOrder(id);
  }

  /* ---------- Modal wiring ---------- */
  $("#approveConfirm").addEventListener("click", ()=>{
    const id = $("#approveConfirm").dataset.target;
    $("#approveToggle").checked = false;
    approveOrder(id);
  });

  /* ---------- Init ---------- */
  renderList();
</script>
</body>
</html>
